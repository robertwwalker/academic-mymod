---
title: Scraping EPL Salary Data
author: RWW
date: '2018-04-08'
slug: scraping-epl-salary-data
categories:
  - R
  - web scraping
tags:
  - R Markdown
  - R
  - tidytext
---



<div id="epl-scraping" class="section level1">
<h1>EPL Scraping</h1>
<p>In a previous post, I scraped some NFL data and learned the structure of Sportrac. Now, I want to scrape the available data on the EPL.</p>
<pre class="r"><code>library(rvest)
library(tidyverse)
base_url &lt;- &quot;http://www.spotrac.com/epl/&quot;
read.base &lt;- read_html(base_url)
team.URL &lt;- read.base %&gt;% html_nodes(&quot;.team-name&quot;) %&gt;% html_attr(&#39;href&#39;)
team.URL</code></pre>
<pre><code>##  [1] &quot;http://www.spotrac.com/epl/afc-bournemouth/&quot;         
##  [2] &quot;http://www.spotrac.com/epl/arsenal-f.c/&quot;             
##  [3] &quot;http://www.spotrac.com/epl/brighton-hove-albion/&quot;    
##  [4] &quot;http://www.spotrac.com/epl/burnley-f.c/&quot;             
##  [5] &quot;http://www.spotrac.com/epl/chelsea-f.c/&quot;             
##  [6] &quot;http://www.spotrac.com/epl/crystal-palace/&quot;          
##  [7] &quot;http://www.spotrac.com/epl/everton-f.c/&quot;             
##  [8] &quot;http://www.spotrac.com/epl/huddersfield-town/&quot;       
##  [9] &quot;http://www.spotrac.com/epl/leicester-city/&quot;          
## [10] &quot;http://www.spotrac.com/epl/liverpool-f.c/&quot;           
## [11] &quot;http://www.spotrac.com/epl/manchester-city-f.c/&quot;     
## [12] &quot;http://www.spotrac.com/epl/manchester-united-f.c/&quot;   
## [13] &quot;http://www.spotrac.com/epl/newcastle-united-f.c/&quot;    
## [14] &quot;http://www.spotrac.com/epl/southampton-f.c/&quot;         
## [15] &quot;http://www.spotrac.com/epl/stoke-city-f.c/&quot;          
## [16] &quot;http://www.spotrac.com/epl/swansea-city-a.f.c/&quot;      
## [17] &quot;http://www.spotrac.com/epl/tottenham-hotspur-f.c/&quot;   
## [18] &quot;http://www.spotrac.com/epl/watford/&quot;                 
## [19] &quot;http://www.spotrac.com/epl/west-bromwich-albion-f.c/&quot;
## [20] &quot;http://www.spotrac.com/epl/west-ham-united-f.c/&quot;</code></pre>
<pre class="r"><code># Clean up the URLs to get the team names by themselves.
team.names &lt;- gsub(base_url, &quot;&quot;, team.URL)
team.names &lt;- gsub(&quot;-f.c&quot;, &quot; FC&quot;, team.names)
team.names &lt;- gsub(&quot;afc&quot;, &quot;AFC&quot;, team.names)
team.names &lt;- gsub(&quot;a.f.c&quot;, &quot;AFC&quot;, team.names)
# Dashes and slashes need to  removed.
team.names &lt;- gsub(&quot;-&quot;, &quot; &quot;, team.names)
team.names &lt;- gsub(&quot;/&quot;, &quot;&quot;, team.names)
# Fix FC and AFC for Bournemouth
simpleCap &lt;- function(x) {
  s &lt;- strsplit(x, &quot; &quot;)[[1]]
  paste(toupper(substring(s, 1,1)), substring(s, 2), sep=&quot;&quot;, collapse=&quot; &quot;)
  }
# Capitalise and trim white space
team.names &lt;- sapply(team.names, simpleCap)
#team.names &lt;- sapply(team.names, trimws)
names(team.names) &lt;- NULL
# Now I have a vector of 20 names.
short.names &lt;- gsub(&quot; FC&quot;,&quot;&quot;, team.names)
short.names &lt;- gsub(&quot; AFC&quot;,&quot;&quot;, short.names)
EPL.names &lt;- data.frame(team.names,short.names,team.URL)
EPL.names</code></pre>
<pre><code>##                 team.names          short.names
## 1          AFC Bournemouth      AFC Bournemouth
## 2               Arsenal FC              Arsenal
## 3     Brighton Hove Albion Brighton Hove Albion
## 4               Burnley FC              Burnley
## 5               Chelsea FC              Chelsea
## 6           Crystal Palace       Crystal Palace
## 7               Everton FC              Everton
## 8        Huddersfield Town    Huddersfield Town
## 9           Leicester City       Leicester City
## 10            Liverpool FC            Liverpool
## 11      Manchester City FC      Manchester City
## 12    Manchester United FC    Manchester United
## 13     Newcastle United FC     Newcastle United
## 14          Southampton FC          Southampton
## 15           Stoke City FC           Stoke City
## 16        Swansea City AFC         Swansea City
## 17    Tottenham Hotspur FC    Tottenham Hotspur
## 18                 Watford              Watford
## 19 West Bromwich Albion FC West Bromwich Albion
## 20      West Ham United FC      West Ham United
##                                                team.URL
## 1           http://www.spotrac.com/epl/afc-bournemouth/
## 2               http://www.spotrac.com/epl/arsenal-f.c/
## 3      http://www.spotrac.com/epl/brighton-hove-albion/
## 4               http://www.spotrac.com/epl/burnley-f.c/
## 5               http://www.spotrac.com/epl/chelsea-f.c/
## 6            http://www.spotrac.com/epl/crystal-palace/
## 7               http://www.spotrac.com/epl/everton-f.c/
## 8         http://www.spotrac.com/epl/huddersfield-town/
## 9            http://www.spotrac.com/epl/leicester-city/
## 10            http://www.spotrac.com/epl/liverpool-f.c/
## 11      http://www.spotrac.com/epl/manchester-city-f.c/
## 12    http://www.spotrac.com/epl/manchester-united-f.c/
## 13     http://www.spotrac.com/epl/newcastle-united-f.c/
## 14          http://www.spotrac.com/epl/southampton-f.c/
## 15           http://www.spotrac.com/epl/stoke-city-f.c/
## 16       http://www.spotrac.com/epl/swansea-city-a.f.c/
## 17    http://www.spotrac.com/epl/tottenham-hotspur-f.c/
## 18                  http://www.spotrac.com/epl/watford/
## 19 http://www.spotrac.com/epl/west-bromwich-albion-f.c/
## 20      http://www.spotrac.com/epl/west-ham-united-f.c/</code></pre>
<pre class="r"><code>team_links &lt;- paste0(team.URL,&quot;payroll/&quot;,sep=&quot;&quot;)</code></pre>
<div id="positional-data" class="section level2">
<h2>Positional Data</h2>
<pre class="r"><code>data.creator &lt;- function(link) {
read_html(link) %&gt;% html_nodes(&quot;table&quot;) %&gt;% html_table(header=TRUE, fill=TRUE)
}
EPL.salary &lt;- sapply(team_links, function(x) {data.creator(x)})
names(EPL.salary) &lt;- EPL.names$short.names
Players &lt;- sapply(seq(1,20), function(x) { str_split(EPL.salary[[x]][[1]][,1], &quot;\t&quot;, simplify=TRUE)[,31]})
Position &lt;- sapply(seq(1,20), function(x) { EPL.salary[[x]][[1]][,2]})
Base.Salary &lt;- sapply(seq(1,20), function(x) { Res &lt;- gsub(&quot;Â£&quot;, &quot;&quot;, EPL.salary[[x]][[1]][,3]); gsub(&quot;,&quot;,&quot;&quot;,Res)})
EPL.Result &lt;- data.frame(Players=unlist(Players), Position=unlist(Position), Base.Salary=unlist(Base.Salary))
EPL.Result$Base.Salary &lt;- str_replace(EPL.Result$Base.Salary, &quot;-&quot;, NA_character_)
EPL.Result$Base.Num &lt;- as.numeric(EPL.Result$Base.Salary)
EPL.Result %&gt;% group_by(Position) %&gt;% summarise(MBN=mean(Base.Num, na.rm=TRUE),sdBSN=sd(Base.Num, na.rm = TRUE))</code></pre>
<pre><code>## # A tibble: 4 x 3
##   Position      MBN    sdBSN
##   &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;
## 1 D        2373070. 1567603.
## 2 F        3270747. 2511928.
## 3 GK       2132456. 1871190.
## 4 M        2874411. 2487494.</code></pre>
</div>
</div>
