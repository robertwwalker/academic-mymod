---
title: 'Black Boxes: A Gender Gap Example'
author: Robert W. Walker
date: '2018-02-22'
slug: black-boxes-a-gender-gap-example
categories:
  - R
  - GSM622
tags:
  - R
  - R Markdown
  - plot
---



<div id="variance-in-the-outcome-the-black-box" class="section level2">
<h2>Variance in the Outcome: The Black Box</h2>
<p>Regression models engage an exercise in variance accounting. How much of the outcome is explained by the inputs, individually (slope divided by standard error is t) and collectively (Average explained/Average unexplained with averaging over degrees of freedom is F). This, of course, assumes normal errors. This document provides a function for making use of the black box. Just as in common parlance, a black box is the unexplained. Letâ€™s take an example.</p>
<pre class="r"><code>options(scipen=10)
OregonSalaries &lt;- structure(list(Obs = 1:32, Salary = c(41514.38701, 40964.06985, 
39170.19178, 37936.57206, 33981.77752, 36077.27107, 39174.05733, 
39037.372, 29131.74865, 36200.44592, 38561.3987, 33247.92306, 
33609.4874, 33669.22275, 37805.83017, 35846.13454, 47342.65909, 
46382.3851, 45812.91029, 46409.65664, 43796.05285, 43124.02135, 
49443.81792, 44805.79217, 44440.32001, 46679.59218, 47337.09786, 
47298.72531, 41461.0474, 43598.293, 43431.18499, 49266.41189), 
    Gender = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 
    1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 
    2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L), .Label = c(&quot;Female&quot;, &quot;Male&quot;
    ), class = &quot;factor&quot;)), .Names = c(&quot;Obs&quot;, &quot;Salary&quot;, &quot;Gender&quot;
), class = &quot;data.frame&quot;, row.names = c(NA, -32L))
black.box.maker &lt;- function(mod1) {
            d1 &lt;- dim(mod1$model)[[1]]
            sumsq1 &lt;- var(mod1$model[,1], na.rm=TRUE)*(d1-1)
            rt1 &lt;- sqrt(sumsq1)
            sumsq2 &lt;- var(mod1$fitted.values, na.rm=TRUE)*(d1-1)
            rsquare &lt;- round(sumsq2/sumsq1, digits=4)
            rt2 &lt;- sqrt(sumsq2)
            plot(x=NA, y=NA, xlim=c(0,rt1), ylim=c(0,rt1), main=paste(&quot;R-squared:&quot;,rsquare), xlab=&quot;&quot;, ylab=&quot;&quot;, bty=&quot;n&quot;, cex=0.5)
            polygon(x=c(0,0,rt1,rt1), y=c(0,rt1,rt1,0), col=&quot;black&quot;)
            polygon(x=c(0,0,rt2,rt2), y=c(0,rt2,rt2,0), col=&quot;green&quot;)
            }</code></pre>
<p>OregonSalaries contains 32 observations: 16 males and 16 females. The mean of all salaries is 41142.4330581; let me put that in a plot in blue. The total sum of squares can be represented as the sum of all the squared distances to the blue line; each vertical distance is demarcated with an arrow below in blue. The total sum of squares: the total area of the black box in the original metric (squared dollars) is: 892955384.313085.</p>
<pre class="r"><code>plot(y=OregonSalaries$Salary, x=c(1:32), ylab=&quot;Salary&quot;, col=as.factor(OregonSalaries$Gender), xlab=&quot;&quot;, pch=c(rep(&quot;F&quot;,16),rep(&quot;M&quot;,16)))
abline(h=mean(OregonSalaries$Salary), col=&quot;blue&quot;)
arrows(x0=c(1:32), x1=c(1:32), y1=OregonSalaries$Salary,y0=mean(OregonSalaries$Salary), col=&quot;blue&quot;, code=3, length=0.05)</code></pre>
<p><img src="/post/2018-02-22-black-boxes-a-gender-gap-example_files/figure-html/PlotG-1.png" width="672" /></p>
</div>
<div id="invoking-the-function" class="section level2">
<h2>Invoking the Function</h2>
<p>To represent the black box,let me draw it. The length of each side will be the square root of the black box; our total sum of squares is just under 900 million squared dollars so each side will be approximately 30000. The box appears below.</p>
<pre class="r"><code>mod1 &lt;- lm(Salary~1, data=OregonSalaries)
black.box.maker(mod1)</code></pre>
<p><img src="/post/2018-02-22-black-boxes-a-gender-gap-example_files/figure-html/BBBase-1.png" width="672" /></p>
</div>
<div id="a-regression-model" class="section level2">
<h2>A Regression Model</h2>
<p>First, a regression model. I will estimate the following regression:</p>
<p><span class="math display">\[ Salary_{i} = \alpha + \beta_{1}*Gender_{i} + \epsilon \]</span></p>
<p>What does the regression imply? That salary for each individual <span class="math inline">\(i\)</span> is a function of a constant and gender. Given the way that R works, <span class="math inline">\(\alpha\)</span> will represent the average for females and <span class="math inline">\(\beta\)</span> will represent the difference between male and female average salaries. Here is a plot of the substance of the result.</p>
<pre class="r"><code>library(gplots)</code></pre>
<pre><code>## 
## Attaching package: &#39;gplots&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     lowess</code></pre>
<pre class="r"><code>plotmeans(Salary~Gender, data=OregonSalaries, ci.label = T, n.label = F, ylim=c(33000,50000))</code></pre>
<p><img src="/post/2018-02-22-black-boxes-a-gender-gap-example_files/figure-html/MeanPlot-1.png" width="672" /></p>
</div>
<div id="a-new-residual-sum-of-squares" class="section level2">
<h2>A New Residual Sum of Squares</h2>
<p>The picture now has a red line and a black line and the residual/leftover/unexplained sum of squares is now the difference between the point and the respective vertical line (red arrows or black arrows). The sum of the remaining squared vertical distances is 238621276.595113. This is the amount leftover or residual given the gender.</p>
<pre class="r"><code>plot(y=OregonSalaries$Salary, x=c(1:32), ylab=&quot;Salary&quot;, col=as.factor(OregonSalaries$Gender), xlab=&quot;&quot;, pch=c(rep(&quot;F&quot;,16),rep(&quot;M&quot;,16)))
abline(h=mean(OregonSalaries$Salary), col=&quot;blue&quot;)
abline(h=mean(subset(OregonSalaries, Gender==&quot;Female&quot;)$Salary, na.rm=T), col=&quot;black&quot;)
abline(h=mean(subset(OregonSalaries, Gender==&quot;Male&quot;)$Salary, na.rm=T), col=&quot;red&quot;)
arrows(x0=c(1:32), x1=c(1:32), y1=OregonSalaries$Salary,y0=mean(OregonSalaries$Salary), col=&quot;blue&quot;, code=3, length=0.05)
arrows(x0=c(1:16), x1=c(1:16), y1=OregonSalaries$Salary[c(1:16)],y0=mean(subset(OregonSalaries, Gender==&quot;Female&quot;)$Salary, na.rm=T), col=&quot;black&quot;, code=3, length=0.05)
arrows(x0=c(17:32), x1=c(17:32), y1=OregonSalaries$Salary[c(17:32)],y0=mean(subset(OregonSalaries, Gender==&quot;Male&quot;)$Salary, na.rm=T), col=&quot;red&quot;, code=3, length=0.05)</code></pre>
<p><img src="/post/2018-02-22-black-boxes-a-gender-gap-example_files/figure-html/BasePlot-1.png" width="672" /></p>
<pre class="r"><code>mod1 &lt;- lm(Salary~Gender, data=OregonSalaries)
black.box.maker(mod1)</code></pre>
<p><img src="/post/2018-02-22-black-boxes-a-gender-gap-example_files/figure-html/BBReg-1.png" width="672" /></p>
<pre class="r"><code>summary(mod1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Salary ~ Gender, data = OregonSalaries)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7488.7 -2107.9   433.3  1743.9  4893.9 
## 
## Coefficients:
##             Estimate Std. Error t value       Pr(&gt;|t|)    
## (Intercept)  36620.5      705.1   51.94        &lt; 2e-16 ***
## GenderMale    9043.9      997.1    9.07 0.000000000422 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2820 on 30 degrees of freedom
## Multiple R-squared:  0.7328, Adjusted R-squared:  0.7239 
## F-statistic: 82.26 on 1 and 30 DF,  p-value: 0.0000000004223</code></pre>
<pre class="r"><code>anova(mod1)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: Salary
##           Df    Sum Sq   Mean Sq F value          Pr(&gt;F)    
## Gender     1 654334108 654334108  82.264 0.0000000004223 ***
## Residuals 30 238621277   7954043                            
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
