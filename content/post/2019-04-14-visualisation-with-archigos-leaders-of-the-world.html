---
title: 'Visualisation with Archigos: Leaders of the World'
author: RWW
date: '2019-04-14'
slug: visualisation-with-archigos-leaders-of-the-world
categories:
  - tidyverse
  - R
  - animation
tags:
  - gganimate
  - R
  - R Markdown
  - tidyverse
header:
  caption: ''
  image: ''
  preview: yes
---



<div id="archigos" class="section level2">
<h2>Archigos</h2>
<p>Is an amazing collaboration that produced a comprehensive dataset of world leaders going pretty far back; see Archigos <a href="http://www.ksgleditsch.com/archigos.html">on the web</a>. For thinking about leadership, it is quite natural. So what do we know?</p>
<pre class="r"><code>library(lubridate)</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ──────────────────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.1       ✔ purrr   0.3.2  
## ✔ tibble  2.1.1       ✔ dplyr   0.8.0.1
## ✔ tidyr   0.8.3       ✔ stringr 1.4.0  
## ✔ readr   1.3.1       ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ─────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ lubridate::as.difftime() masks base::as.difftime()
## ✖ lubridate::date()        masks base::date()
## ✖ dplyr::filter()          masks stats::filter()
## ✖ lubridate::intersect()   masks base::intersect()
## ✖ dplyr::lag()             masks stats::lag()
## ✖ lubridate::setdiff()     masks base::setdiff()
## ✖ lubridate::union()       masks base::union()</code></pre>
<pre class="r"><code>library(ggthemes)
library(stringr)
library(gganimate)
library(emoGG)
library(emojifont)</code></pre>
<pre><code>## 
## Attaching package: &#39;emojifont&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:emoGG&#39;:
## 
##     geom_emoji</code></pre>
<pre class="r"><code>library(haven)
Archigos &lt;- read_dta(url(&quot;http://www.rochester.edu/college/faculty/hgoemans/Archigos_4.1_stata14.dta&quot;))
head(Archigos)</code></pre>
<pre><code>## # A tibble: 6 x 28
##   obsid leadid ccode idacr leader startdate eindate    enddate eoutdate  
##   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;date&gt;     &lt;chr&gt;   &lt;date&gt;    
## 1 USA-… 81dcc…     2 USA   Grant  1869-03-… 1869-03-04 1877-0… 1877-03-04
## 2 USA-… 81dcc…     2 USA   Hayes  1877-03-… 1877-03-04 1881-0… 1881-03-04
## 3 USA-… 81dcf…     2 USA   Garfi… 1881-03-… 1881-03-04 1881-0… 1881-09-19
## 4 USA-… 81dcf…     2 USA   Arthur 1881-09-… 1881-09-19 1885-0… 1885-03-04
## 5 USA-… 34fb1…     2 USA   Cleve… 1885-03-… 1885-03-04 1889-0… 1889-03-04
## 6 USA-… 81dcf…     2 USA   Harri… 1889-03-… 1889-03-04 1893-0… 1893-03-04
## # … with 19 more variables: entry &lt;chr&gt;, exit &lt;chr&gt;, exitcode &lt;chr&gt;,
## #   prevtimesinoffice &lt;dbl&gt;, posttenurefate &lt;chr&gt;, gender &lt;chr&gt;,
## #   yrborn &lt;dbl&gt;, yrdied &lt;dbl&gt;, borndate &lt;chr&gt;, ebirthdate &lt;date&gt;,
## #   deathdate &lt;chr&gt;, edeathdate &lt;date&gt;, dbpediauri &lt;chr&gt;, numentry &lt;dbl&gt;,
## #   numexit &lt;dbl&gt;, numexitcode &lt;dbl&gt;, numposttenurefate &lt;dbl&gt;,
## #   fties &lt;chr&gt;, ftcur &lt;chr&gt;</code></pre>
<p>That’s a pretty impressive span of leaders.</p>
</div>
<div id="on-leaders" class="section level2">
<h2>On Leaders</h2>
<p>The tidyverse will make this workable. The first step is to visualise some features. Using the <code>R</code> equivalent of a pivot table, let’s summarise the frequency of leaders. Because the leader is the basic unit of analysis, we want to group the data by country and then count the number of leaders for each country. The resulting dataset should be collapsed to the number of countries.</p>
<pre class="r"><code>Shorty &lt;- Archigos %&gt;% group_by(idacr) %&gt;% summarise(count=n())
skimr::skim(Shorty)</code></pre>
<pre><code>## Skim summary statistics
##  n obs: 189 
##  n variables: 2 
## 
## ── Variable type:character ──────────────────────────────────────────────────────────────────────────────────────────
##  variable missing complete   n min max empty n_unique
##     idacr       0      189 189   3   3     0      189
## 
## ── Variable type:integer ────────────────────────────────────────────────────────────────────────────────────────────
##  variable missing complete   n  mean    sd p0 p25 p50 p75 p100     hist
##     count       0      189 189 18.04 20.39  1   6  11  24  141 ▇▂▁▁▁▁▁▁</code></pre>
<p>Hmm, there are countries that only had one leader. I wonder who they are.</p>
<pre class="r"><code>Shorty %&gt;% filter(count==1)</code></pre>
<pre><code>## # A tibble: 8 x 2
##   idacr count
##   &lt;chr&gt; &lt;int&gt;
## 1 BAV       1
## 2 BRU       1
## 3 ERI       1
## 4 KZK       1
## 5 MNG       1
## 6 SSD       1
## 7 UZB       1
## 8 VIE       1</code></pre>
<p>The names are not extremely informative but two are post-Soviet republics, Eritrea is very young, and that some are countries that ceased to exist shortly after the start point of the data. What are the other extremum? What countries have had more than 80 leaders?</p>
<pre class="r"><code>Shorty %&gt;% filter(count &gt; 80) %&gt;% ggplot(aes(x=idacr, y=count, label=idacr)) + geom_point() + geom_label() + theme_minimal() + ggtitle(&quot;Countries with More than 80 Leaders&quot;) + labs(x=&quot;&quot;, y=&quot;Number of Leaders&quot;) + theme(axis.text.x = element_blank())</code></pre>
<p><img src="/post/2019-04-14-visualisation-with-archigos-leaders-of-the-world_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>France, Greece, Japan, and Switzerland have had a large number of leaders during this period. What does the data look like?</p>
<pre class="r"><code>ggplot(data = Shorty) +
    aes(x = count) +
    geom_histogram(bins = 100, fill = &#39;#9c179e&#39;) +
    labs(title = &#39;How Many Leaders since 1875?&#39;,
         x = &#39;Number of Leaders&#39;,
         y = &#39;Number of Countries&#39;,
         caption = &#39;data from Archigos&#39;) +
    theme_economist_white()</code></pre>
<p><img src="/post/2019-04-14-visualisation-with-archigos-leaders-of-the-world_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="on-duration" class="section level2">
<h2>On Duration</h2>
<pre class="r"><code>Archigos %&gt;% mutate(Duration = difftime(enddate, startdate, units=&quot;weeks&quot;)/52) %&gt;% ggplot(aes(Duration)) + geom_histogram(bins=50, fill = &#39;#9c179e&#39;) + theme_economist_white() + labs(x=&quot;Frequency&quot;, y=&quot;Duration of Leader in Weeks [divided by 52]&quot;)</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type difftime. Defaulting to continuous.</code></pre>
<p><img src="/post/2019-04-14-visualisation-with-archigos-leaders-of-the-world_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="who-leads-longest" class="section level2">
<h2>Who leads longest?</h2>
<pre class="r"><code>Archigos %&gt;% mutate(Duration = difftime(enddate, startdate, units=&quot;weeks&quot;)) %&gt;% select(leader,Duration) %&gt;% arrange(desc(Duration)) %&gt;% mutate(DurationInYears = Duration / 52)</code></pre>
<pre><code>## # A tibble: 3,409 x 3
##    leader                      Duration       DurationInYears
##    &lt;chr&gt;                       &lt;time&gt;         &lt;time&gt;         
##  1 Francis Joseph I            3546.429 weeks 68.20056 weeks 
##  2 Nikola I Petrovic-Njegos    2944.286 weeks 56.62089 weeks 
##  3 George I                    2607.144 weeks 50.13738 weeks 
##  4 Pedro II                    2573.144 weeks 49.48353 weeks 
##  5 Castro                      2564.286 weeks 49.31319 weeks 
##  6 Carol I                     2524.572 weeks 48.54946 weeks 
##  7 Hassanal Bolkiah            2517.149 weeks 48.40671 weeks 
##  8 Nasir Ad-Din                2485.286 weeks 47.79397 weeks 
##  9 Tz&#39;u Hsi                    2464.429 weeks 47.39287 weeks 
## 10 Hussein Ibn Talal El-Hashim 2425.863 weeks 46.65121 weeks 
## # … with 3,399 more rows</code></pre>
</div>
<div id="what-happens-to-leaders" class="section level2">
<h2>What happens to leaders?</h2>
<pre class="r"><code>Archigos %&gt;% ggplot(., aes(posttenurefate)) + geom_bar(fill=&quot;purple&quot;) + coord_flip() + labs(y=&quot;Frequency&quot;, x=&quot;&quot;) + theme(axis.text.y = element_text(color = &quot;purple&quot;, size = 8))</code></pre>
<p><img src="/post/2019-04-14-visualisation-with-archigos-leaders-of-the-world_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="melting" class="section level2">
<h2>Melting</h2>
<p>Now I want to analyse this as discrete data in annual form. I will use the lovely lubridate to extract the components of the date and then create a pivot table of sorts.</p>
<pre class="r"><code>Archigos &lt;- Archigos %&gt;% group_by(idacr) %&gt;% mutate(endYear = year(enddate)) %&gt;% ungroup()</code></pre>
<p>Now I can visualise turnovers on a yearly basis.</p>
<pre class="r"><code>YearlyD &lt;- Archigos %&gt;% group_by(endYear) %&gt;% summarise(Endeds = n()) %&gt;% filter(endYear &lt; 2015)
YearlyD$label &lt;- emoji(&quot;pencil2&quot;)
p &lt;- YearlyD %&gt;% ggplot(., aes(x=endYear, y=Endeds, label=label, colour=&quot;steelblue&quot;)) + geom_text(family=&quot;EmojiOne&quot;, size=10, position=position_nudge(x = 5, y = 5), color=&quot;steelblue&quot;) + geom_line(colour=&quot;steelblue&quot;) + theme_minimal() + labs(x=&quot;Year&quot;, y=&quot;Number of Leader-Tenures Ending&quot;)
panim &lt;- p +  transition_reveal(endYear)
animate(panim, nframes=200)</code></pre>
<p><img src="/post/2019-04-14-visualisation-with-archigos-leaders-of-the-world_files/figure-html/unnamed-chunk-9-1.gif" /><!-- --></p>
<p><code>gganimate</code> is a very neat tool. Now on to looking at what is happening at the country year and year level. In some ways, the previous is deceiving because the number of countries is widely varying over time. Let’s try to fill this in. First, let me obtain a list of the countries. This is a link from the Archigos website to the work of Gleditsch and Ward. The dates that they store are colon rather than dash separated so that needs to be fixed, then I convert the dates to valid date format.</p>
<pre class="r"><code>iisystem &lt;- read.delim(url(&quot;http://www.ksgleditsch.com/data/iisystem.dat&quot;), col.names=c(&quot;ccode&quot;,&quot;idacr&quot;,&quot;CountryName&quot;,&quot;startD&quot;,&quot;endD&quot;), stringsAsFactors = FALSE)
iisystem &lt;- iisystem %&gt;% mutate(startD = str_replace_all(startD, &quot;:&quot;, &quot;-&quot;))
iisystem &lt;- iisystem %&gt;% mutate(endD = str_replace_all(endD, &quot;:&quot;, &quot;-&quot;))
iisystem$startD &lt;- as_date(dmy(iisystem$startD))
iisystem$endD &lt;- as_date(dmy(iisystem$endD))</code></pre>
<p>Now for a fully populated dataset of countries and time periods. <code>hYear</code> will be the hypothetical year so a series from 1816 to 2017 for every possible country. Then we use the system membership data to pare that down to valid dates by country by keeping the years between start and end.</p>
<pre class="r"><code>hYear &lt;- seq(1816,2017)
CSTS &lt;- expand.grid(iisystem$idacr,hYear, stringsAsFactors = FALSE)
CSTS &lt;- data.frame(idacr=CSTS$Var1, year=CSTS$Var2)
iisystem &lt;- iisystem %&gt;% mutate(IISstartYear = year(startD), IISendYear = year(endD))
Big.CSTS &lt;- left_join(CSTS, iisystem, by=&quot;idacr&quot;)</code></pre>
<pre><code>## Warning: Column `idacr` joining factor and character vector, coercing into
## character vector</code></pre>
<pre class="r"><code>Big.CSTS$year[!(Big.CSTS$year &gt;= Big.CSTS$IISstartYear &amp; Big.CSTS$year &lt;= Big.CSTS$IISendYear)] &lt;- NA
skimr::skim(Big.CSTS)</code></pre>
<pre><code>## Skim summary statistics
##  n obs: 49086 
##  n variables: 8 
## 
## ── Variable type:character ──────────────────────────────────────────────────────────────────────────────────────────
##     variable missing complete     n min max empty n_unique
##  CountryName       0    49086 49086   4  39     0      202
##        idacr       0    49086 49086   3   3     0      201
## 
## ── Variable type:Date ───────────────────────────────────────────────────────────────────────────────────────────────
##  variable missing complete     n        min        max     median n_unique
##      endD       0    49086 49086 1830-07-05 2017-12-31 2017-12-31       30
##    startD       0    49086 49086 1816-01-01 2011-07-09 1946-07-04      153
## 
## ── Variable type:integer ────────────────────────────────────────────────────────────────────────────────────────────
##  variable missing complete     n    mean     sd   p0  p25  p50  p75 p100
##     ccode       0    49086 49086  461.83 227.82   20  325  439  651  950
##      year   30065    19021 49086 1940.74  59.39 1816 1891 1960 1992 2017
##      hist
##  ▃▂▇▅▅▆▃▁
##  ▂▃▂▂▃▅▆▇
## 
## ── Variable type:numeric ────────────────────────────────────────────────────────────────────────────────────────────
##      variable missing complete     n    mean    sd   p0  p25  p50  p75
##    IISendYear       0    49086 49086 1989.95 53.74 1830 2017 2017 2017
##  IISstartYear       0    49086 49086 1912.68 67.4  1816 1827 1946 1965
##  p100     hist
##  2017 ▁▁▁▁▁▁▁▇
##  2011 ▇▁▁▁▂▇▃▃</code></pre>
<p>So that gives me the basic country year dataset that defines the various existence years from countries. Neat. Now I need to collapse a country year version of Archigos and merge it into my country year template for existence. That is called <code>Keepers</code>. Then I collapse them to years and animate the turnover proportion over time.</p>
<pre class="r"><code>Big.CSTS &lt;- Big.CSTS %&gt;% group_by(year) %&gt;% mutate(Countries = n()) %&gt;% ungroup()
Working.CSTS &lt;- Big.CSTS %&gt;% filter(is.na(year)==FALSE)
CountryYear &lt;- Archigos %&gt;% group_by(idacr, endYear) %&gt;% summarise(eventCount = n()) %&gt;% ungroup()
CountryYear$Mults &lt;- as.numeric(CountryYear$eventCount &gt; 1)
Keepers &lt;- left_join(Working.CSTS, CountryYear, by=c(&quot;idacr&quot;=&quot;idacr&quot;,&quot;year&quot;=&quot;endYear&quot;))</code></pre>
<pre><code>## Warning: Column `idacr` has different attributes on LHS and RHS of join</code></pre>
<pre class="r"><code>Keepers$Mults[is.na(Keepers$eventCount)==TRUE] &lt;- 0
Keepers$eventCount[is.na(Keepers$eventCount)==TRUE] &lt;- 0
Keepers$Event &lt;- as.numeric(Keepers$eventCount &gt; 0)
#library(DAMisc)
Shorty2 &lt;- Keepers %&gt;% filter(year&gt;1874 &amp; year &lt; 2015) 
Shorty2 &lt;- Shorty2%&gt;% group_by(year) %&gt;% summarise(FailRate = mean(Event))
Shorty2$label &lt;- emoji(&quot;pencil2&quot;)
p &lt;- Shorty2 %&gt;% ggplot(., aes(x=year, y=FailRate, label=label, colour=&#39;steelblue&#39;)) + geom_text(family=&quot;EmojiOne&quot;, size=10, position=position_nudge(x = 5, y = 0.03), color=&#39;steelblue&#39;) + geom_line(color=&#39;steelblue&#39;) + theme_minimal() + labs(x=&quot;Year&quot;, y=&quot;Proportion Leader-Tenures Ending&quot;) + ylim(c(0,0.5))
panim &lt;- p +  transition_reveal(year)
animate(panim, nframes=200)</code></pre>
<p><img src="/post/2019-04-14-visualisation-with-archigos-leaders-of-the-world_files/figure-html/unnamed-chunk-12-1.gif" /><!-- --></p>
</div>
